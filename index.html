<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#10b981">
  <meta name="description" content="Uber Eatsé…é”ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼å‘ã‘é€±é–“å£²ä¸Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼">
  <title>Uberè¨˜éŒ²</title>
  <link rel="manifest" href="manifest.json?v=4">
  <link rel="icon" type="image/svg+xml" href="favicon.svg?v=4">
  <link rel="apple-touch-icon" href="favicon.svg?v=4">
  <script crossorigin="anonymous" src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin="anonymous" src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script crossorigin="anonymous" src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overscroll-behavior-x: none;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Lucide icons as simple SVG components
    const Calculator = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect x="4" y="2" width="16" height="20" rx="2"/>
        <line x1="8" y1="6" x2="16" y2="6"/>
        <line x1="16" y1="14" x2="16" y2="14.01"/>
        <line x1="12" y1="14" x2="12" y2="14.01"/>
        <line x1="8" y1="14" x2="8" y2="14.01"/>
        <line x1="16" y1="18" x2="16" y2="18.01"/>
        <line x1="12" y1="18" x2="12" y2="18.01"/>
        <line x1="8" y1="18" x2="8" y2="18.01"/>
      </svg>
    );

    const DollarSign = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="1" x2="12" y2="23"/>
        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
      </svg>
    );

    const Settings = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="3"/>
        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
      </svg>
    );

    const Package = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/>
        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
        <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
        <line x1="12" y1="22.08" x2="12" y2="12"/>
      </svg>
    );

    const Award = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="8" r="7"/>
        <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/>
      </svg>
    );

    const Calendar = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
        <line x1="16" y1="2" x2="16" y2="6"/>
        <line x1="8" y1="2" x2="8" y2="6"/>
        <line x1="3" y1="10" x2="21" y2="10"/>
      </svg>
    );

    function UberEatsSimulator() {
      // å®šæ•°å®šç¾©
      const days = ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥'];
      const weekdays = ['æœˆ', 'ç«', 'æ°´', 'æœ¨'];
      const weekends = ['é‡‘', 'åœŸ', 'æ—¥'];

      // localStorageã®å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯ã¨ä¿®å¾©
      const validateAndFixLocalStorage = () => {
        try {
          // å„ã‚­ãƒ¼ã‚’æ¤œè¨¼
          const keysToValidate = [
            'weekdayAvgPrice', 'weekendAvgPrice',
            'weekdayDeliveriesPerHour', 'weekendDeliveriesPerHour',
            'useAutoCalculate', 'weekdayQuests', 'weekendQuests',
            'hours', 'targetAmount', 'dailyData',
            'currentWeekStart', 'lastAccessDate'
          ];

          keysToValidate.forEach(key => {
            try {
              const value = localStorage.getItem(key);
              if (value && value !== 'undefined' && value !== 'null') {
                // JSON.parseã‚’è©¦ã™
                JSON.parse(value);
              }
            } catch (e) {
              console.warn(`Removing corrupted localStorage key: ${key}`);
              localStorage.removeItem(key);
            }
          });
        } catch (error) {
          console.error('localStorage validation error:', error);
        }
      };

      // ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«å®Ÿè¡Œ
      validateAndFixLocalStorage();

      // ãƒ¢ãƒ¼ãƒ€ãƒ«çŠ¶æ…‹
      const [showBasicSettings, setShowBasicSettings] = useState(false);
      const [showQuestSettings, setShowQuestSettings] = useState(false);
      const [showCalendar, setShowCalendar] = useState(false);
      const [showTotalStats, setShowTotalStats] = useState(false);
      const [totalStatsTab, setTotalStatsTab] = useState('summary'); // 'summary' or 'daily'

      // å¤ã„localStorageã‚­ãƒ¼ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆä¸€åº¦ã ã‘å®Ÿè¡Œï¼‰
      try {
        if (typeof window !== 'undefined' && typeof localStorage !== 'undefined' && !localStorage.getItem('cleanupDone_v2')) {
          // å¤ã„ã‚­ãƒ¼ã‚’å‰Šé™¤
          localStorage.removeItem('avgPrice');
          localStorage.removeItem('deliveriesPerHour');
          localStorage.setItem('cleanupDone_v2', 'true');
        }
      } catch (error) {
        console.error('localStorage cleanup error:', error);
      }

      // localStorageã‹ã‚‰åˆæœŸå€¤ã‚’èª­ã¿è¾¼ã‚€ï¼ˆå®‰å…¨ç‰ˆï¼‰
      const loadFromStorage = (key, defaultValue) => {
        try {
          if (typeof window !== 'undefined' && typeof localStorage !== 'undefined') {
            const saved = localStorage.getItem(key);
            if (saved === null || saved === undefined || saved === 'undefined' || saved === 'null') {
              return defaultValue;
            }
            try {
              return JSON.parse(saved);
            } catch (parseError) {
              console.error(`JSON parse error for key ${key}:`, parseError);
              return defaultValue;
            }
          }
        } catch (error) {
          console.error(`localStorage load error for key ${key}:`, error);
        }
        return defaultValue;
      };

      // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã®ref
      const fileInputRef = useRef(null);

      // åŸºæœ¬è¨­å®š
      const [weekdayAvgPrice, setWeekdayAvgPrice] = useState(() => loadFromStorage('weekdayAvgPrice', 400));
      const [weekendAvgPrice, setWeekendAvgPrice] = useState(() => loadFromStorage('weekendAvgPrice', 400));
      const [weekdayDeliveriesPerHour, setWeekdayDeliveriesPerHour] = useState(() => loadFromStorage('weekdayDeliveriesPerHour', 4));
      const [weekendDeliveriesPerHour, setWeekendDeliveriesPerHour] = useState(() => loadFromStorage('weekendDeliveriesPerHour', 4));
      const [useAutoCalculate, setUseAutoCalculate] = useState(() => loadFromStorage('useAutoCalculate', false));
      
      // ã‚¯ã‚¨ã‚¹ãƒˆè¨­å®š - æœˆï½æœ¨ç”¨
      const [weekdayQuests, setWeekdayQuests] = useState(() => loadFromStorage('weekdayQuests', [
        { count: 10, reward: 0 },
        { count: 10, reward: 0 },
        { count: 10, reward: 0 },
        { count: 10, reward: 0 },
        { count: 10, reward: 0 }
      ]));
      
      // ã‚¯ã‚¨ã‚¹ãƒˆè¨­å®š - é‡‘ï½æ—¥ç”¨
      const [weekendQuests, setWeekendQuests] = useState(() => loadFromStorage('weekendQuests', [
        { count: 10, reward: 0 },
        { count: 10, reward: 0 },
        { count: 10, reward: 0 },
        { count: 10, reward: 0 },
        { count: 10, reward: 0 }
      ]));
      
      // å„æ›œæ—¥ã®ç¨¼åƒæ™‚é–“ãƒ»ä»¶æ•°ãƒ»é‡‘é¡
      const [hours, setHours] = useState(() => {
        const saved = loadFromStorage('hours', null);
        // æ—§å½¢å¼ã‹ã‚‰æ–°å½¢å¼ã¸ã®ç§»è¡Œ
        if (saved && typeof saved['æœˆ'] === 'number') {
          const converted = {};
          days.forEach(day => {
            converted[day] = { hours: saved[day] || 0, deliveries: 0, earnings: 0 };
          });
          return converted;
        }
        return loadFromStorage('hours', {
          æœˆ: { hours: 0, deliveries: 0, earnings: 0 },
          ç«: { hours: 0, deliveries: 0, earnings: 0 },
          æ°´: { hours: 0, deliveries: 0, earnings: 0 },
          æœ¨: { hours: 0, deliveries: 0, earnings: 0 },
          é‡‘: { hours: 0, deliveries: 0, earnings: 0 },
          åœŸ: { hours: 0, deliveries: 0, earnings: 0 },
          æ—¥: { hours: 0, deliveries: 0, earnings: 0 }
        });
      });
      
      // ç›®æ¨™é‡‘é¡
      const [targetAmount, setTargetAmount] = useState(() => loadFromStorage('targetAmount', 0));

      // éå»ã®å£²ä¸Šãƒ‡ãƒ¼ã‚¿ï¼ˆæ—¥ä»˜ã‚­ãƒ¼: YYYY-MM-DDå½¢å¼ï¼‰
      const [historicalData, setHistoricalData] = useState(() => loadFromStorage('historicalData', {}));

      // æ—¥å˜ä½ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆæ—¥ä»˜ã‚­ãƒ¼: YYYY-MM-DDå½¢å¼ï¼‰
      const [dailyData, setDailyData] = useState(() => {
        const data = loadFromStorage('dailyData', {});

        // ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: æ—§å½¢å¼ï¼ˆUTCï¼‰ã®ã‚­ãƒ¼ã‚’æ–°å½¢å¼ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ï¼‰ã«å¤‰æ›
        const migrationDone = loadFromStorage('dailyDataMigrated', false);
        if (!migrationDone && Object.keys(data).length > 0) {
          const migratedData = {};
          Object.entries(data).forEach(([dateStr, value]) => {
            // æ—§å½¢å¼ã®ã‚­ãƒ¼ï¼ˆUTCåŸºæº–ï¼‰ã‚’æ—¥ä»˜ã¨ã—ã¦è§£é‡ˆã—ã€1æ—¥é€²ã‚ã‚‹
            // ä¾‹: "2025-01-14" â†’ 2025-01-15ï¼ˆå®Ÿéš›ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸã‹ã£ãŸæ—¥ä»˜ï¼‰
            const oldDate = new Date(dateStr + 'T00:00:00'); // ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã¨ã—ã¦è§£é‡ˆ
            oldDate.setDate(oldDate.getDate() + 1); // 1æ—¥é€²ã‚ã‚‹

            const year = oldDate.getFullYear();
            const month = String(oldDate.getMonth() + 1).padStart(2, '0');
            const day = String(oldDate.getDate()).padStart(2, '0');
            const newKey = `${year}-${month}-${day}`;

            migratedData[newKey] = value;
          });

          // ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†ãƒ•ãƒ©ã‚°ã‚’ä¿å­˜
          if (typeof window !== 'undefined') {
            localStorage.setItem('dailyDataMigrated', JSON.stringify(true));
          }

          return migratedData;
        }

        return data;
      });

      // æœ€å¾Œã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸæ—¥ä»˜
      const [lastAccessDate, setLastAccessDate] = useState(() => loadFromStorage('lastAccessDate', null));

      // ç¾åœ¨ã®é€±ã®é–‹å§‹æ—¥ï¼ˆæœˆæ›œæ—¥ï¼‰
      const [currentWeekStart, setCurrentWeekStart] = useState(() => loadFromStorage('currentWeekStart', null));

      // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é–¢é€£ã®state
      const [currentMonth, setCurrentMonth] = useState(() => new Date());
      const [selectedDate, setSelectedDate] = useState(null);
      const [originalSelectedDate, setOriginalSelectedDate] = useState(null); // æ—¥ä»˜å¤‰æ›´ç”¨
      const [showDayEdit, setShowDayEdit] = useState(false);
      const [isChangingDate, setIsChangingDate] = useState(false); // æ—¥ä»˜å¤‰æ›´ãƒ¢ãƒ¼ãƒ‰
      const [editingDayData, setEditingDayData] = useState({ hours: 0, deliveries: 0, earnings: 0, quest: 0 });

      // æ—¥ä»˜ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§YYYY-MM-DDå½¢å¼ã«å¤‰æ›
      const formatDateToLocal = (date) => {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      };

      // å±¥æ­´ã‹ã‚‰å¹³å‡å€¤ã‚’è¨ˆç®—ï¼ˆæœˆï½æœ¨ã¨é‡‘ï½æ—¥ã§åˆ†ã‘ã‚‹ï¼‰
      const calculateFromHistory = () => {
        const allEntries = Object.entries(dailyData);
        if (allEntries.length === 0) {
          return {
            weekdayAvgPrice: 400,
            weekendAvgPrice: 400,
            weekdayDeliveriesPerHour: 4,
            weekendDeliveriesPerHour: 4
          };
        }

        let weekdayHours = 0;
        let weekdayDeliveries = 0;
        let weekdayEarnings = 0;

        let weekendHours = 0;
        let weekendDeliveries = 0;
        let weekendEarnings = 0;

        allEntries.forEach(([dateStr, data]) => {
          if (data.hours > 0 && data.deliveries > 0 && data.earnings > 0) {
            const date = new Date(dateStr + 'T00:00:00');
            const dayOfWeek = date.getDay(); // 0=æ—¥, 1=æœˆ, 2=ç«, ..., 6=åœŸ

            // æœˆ(1)ï½æœ¨(4) = weekday, é‡‘(5)ï½æ—¥(0,6) = weekend
            if (dayOfWeek >= 1 && dayOfWeek <= 4) {
              weekdayHours += data.hours;
              weekdayDeliveries += data.deliveries;
              weekdayEarnings += data.earnings;
            } else {
              weekendHours += data.hours;
              weekendDeliveries += data.deliveries;
              weekendEarnings += data.earnings;
            }
          }
        });

        return {
          weekdayAvgPrice: weekdayDeliveries > 0 ? Math.round(weekdayEarnings / weekdayDeliveries) : 400,
          weekendAvgPrice: weekendDeliveries > 0 ? Math.round(weekendEarnings / weekendDeliveries) : 400,
          weekdayDeliveriesPerHour: weekdayHours > 0 ? parseFloat((weekdayDeliveries / weekdayHours).toFixed(1)) : 4,
          weekendDeliveriesPerHour: weekendHours > 0 ? parseFloat((weekendDeliveries / weekendHours).toFixed(1)) : 4
        };
      };

      // ä½¿ç”¨ã™ã‚‹å¹³å‡å€¤ã‚’å–å¾—ï¼ˆè‡ªå‹•ç®—å‡º or æ‰‹å‹•å…¥åŠ›ï¼‰
      const getEffectiveValues = () => {
        if (useAutoCalculate) {
          return calculateFromHistory();
        }
        return {
          weekdayAvgPrice,
          weekendAvgPrice,
          weekdayDeliveriesPerHour,
          weekendDeliveriesPerHour
        };
      };

      // ãƒ‡ãƒ¼ã‚¿ã‚’localStorageã«ä¿å­˜
      useEffect(() => {
        if (typeof window !== 'undefined') {
          localStorage.setItem('weekdayAvgPrice', JSON.stringify(weekdayAvgPrice));
        }
      }, [weekdayAvgPrice]);

      useEffect(() => {
        if (typeof window !== 'undefined') {
          localStorage.setItem('weekendAvgPrice', JSON.stringify(weekendAvgPrice));
        }
      }, [weekendAvgPrice]);

      useEffect(() => {
        if (typeof window !== 'undefined') {
          localStorage.setItem('weekdayDeliveriesPerHour', JSON.stringify(weekdayDeliveriesPerHour));
        }
      }, [weekdayDeliveriesPerHour]);

      useEffect(() => {
        if (typeof window !== 'undefined') {
          localStorage.setItem('weekendDeliveriesPerHour', JSON.stringify(weekendDeliveriesPerHour));
        }
      }, [weekendDeliveriesPerHour]);

      useEffect(() => {
        if (typeof window !== 'undefined') {
          localStorage.setItem('useAutoCalculate', JSON.stringify(useAutoCalculate));
        }
      }, [useAutoCalculate]);
      
      useEffect(() => {
        if (typeof window !== 'undefined') {
          localStorage.setItem('weekdayQuests', JSON.stringify(weekdayQuests));
        }
      }, [weekdayQuests]);
      
      useEffect(() => {
        if (typeof window !== 'undefined') {
          localStorage.setItem('weekendQuests', JSON.stringify(weekendQuests));
        }
      }, [weekendQuests]);
      
      useEffect(() => {
        if (typeof window !== 'undefined') {
          localStorage.setItem('hours', JSON.stringify(hours));
        }
      }, [hours]);
      
      useEffect(() => {
        if (typeof window !== 'undefined') {
          localStorage.setItem('targetAmount', JSON.stringify(targetAmount));
        }
      }, [targetAmount]);

      useEffect(() => {
        if (typeof window !== 'undefined') {
          localStorage.setItem('historicalData', JSON.stringify(historicalData));
        }
      }, [historicalData]);

      useEffect(() => {
        if (typeof window !== 'undefined') {
          localStorage.setItem('lastAccessDate', JSON.stringify(lastAccessDate));
        }
      }, [lastAccessDate]);

      useEffect(() => {
        if (typeof window !== 'undefined') {
          localStorage.setItem('currentWeekStart', JSON.stringify(currentWeekStart));
        }
      }, [currentWeekStart]);

      useEffect(() => {
        if (typeof window !== 'undefined') {
          localStorage.setItem('dailyData', JSON.stringify(dailyData));
        }
      }, [dailyData]);

      // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºä¸­ã¯èƒŒæ™¯ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç„¡åŠ¹åŒ–
      useEffect(() => {
        try {
          const isModalOpen = showBasicSettings || showQuestSettings || showCalendar || showTotalStats || showDayEdit;
          if (typeof document !== 'undefined' && document.body) {
            if (isModalOpen) {
              document.body.style.overflow = 'hidden';
            } else {
              document.body.style.overflow = '';
            }
          }
        } catch (error) {
          console.error('ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åˆ¶å¾¡ã‚¨ãƒ©ãƒ¼:', error);
        }
        return () => {
          try {
            if (typeof document !== 'undefined' && document.body) {
              document.body.style.overflow = '';
            }
          } catch (error) {
            console.error('ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è§£é™¤ã‚¨ãƒ©ãƒ¼:', error);
          }
        };
      }, [showBasicSettings, showQuestSettings, showCalendar, showTotalStats, showDayEdit]);

      // é€±ã®ç¨¼åƒæ™‚é–“ãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰ã€ã‚¯ã‚¨ã‚¹ãƒˆå ±é…¬ã‚’è¨ˆç®—ã—ã¦ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«åæ˜ 
      useEffect(() => {
        if (!currentWeekStart) return;

        // ä½¿ç”¨ã™ã‚‹å¹³å‡å€¤ã‚’å–å¾—
        const effectiveValues = getEffectiveValues();

        setDailyData(prev => {
          const updatedData = { ...prev };

          // ã¾ãšã€é€±ã®ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’updatedDataã«åæ˜ 
          [...weekdays, ...weekends].forEach(day => {
            const dayData = hours[day];
            const hasAllFields = dayData.hours > 0 &&
                               dayData.deliveries > 0 &&
                               dayData.earnings > 0;

            const dateStr = getDayDate(day);
            if (dateStr) {
              if (hasAllFields) {
                // å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯ä¿å­˜ï¼ˆã‚¯ã‚¨ã‚¹ãƒˆã¯å¾Œã§è¨ˆç®—ï¼‰
                updatedData[dateStr] = {
                  hours: dayData.hours,
                  deliveries: dayData.deliveries,
                  earnings: dayData.earnings,
                  quest: 0
                };
              } else if (updatedData[dateStr]) {
                // ä¸å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿ã®å ´åˆã¯å‰Šé™¤
                delete updatedData[dateStr];
              }
            }
          });

          // æœˆï½æœ¨ã®ã‚¯ã‚¨ã‚¹ãƒˆå ±é…¬ã‚’é”æˆã—ãŸæ—¥ã«é…åˆ†
          let cumulativeWeekday = 0;
          let nextQuestIndex = 0;
          let cumulativeQuestCount = 0;

          weekdays.forEach(day => {
            const dayData = hours[day];
            const dayDeliveries = dayData.deliveries > 0 ? dayData.deliveries : dayData.hours * effectiveValues.weekdayDeliveriesPerHour;
            cumulativeWeekday += dayDeliveries;

            // ã“ã®æ—¥ã«é”æˆã—ãŸã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¢ºèª
            let dayQuestReward = 0;
            while (nextQuestIndex < weekdayQuests.length) {
              const nextThreshold = cumulativeQuestCount + weekdayQuests[nextQuestIndex].count;
              if (cumulativeWeekday >= nextThreshold) {
                dayQuestReward += weekdayQuests[nextQuestIndex].reward;
                cumulativeQuestCount = nextThreshold;
                nextQuestIndex++;
              } else {
                break;
              }
            }

            // ã“ã®æ—¥ã«ã‚¯ã‚¨ã‚¹ãƒˆå ±é…¬ãŒã‚ã‚Šã€ã‹ã¤å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆã«è¨­å®š
            const dateStr = getDayDate(day);
            if (dateStr && dayQuestReward > 0 && updatedData[dateStr] &&
                updatedData[dateStr].hours > 0 &&
                updatedData[dateStr].deliveries > 0 &&
                updatedData[dateStr].earnings > 0) {
              // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã€å…¨ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚Œã°ã‚¯ã‚¨ã‚¹ãƒˆã‚’è¿½åŠ 
              updatedData[dateStr] = {
                ...updatedData[dateStr],
                quest: dayQuestReward
              };
            }
          });

          // é‡‘ï½æ—¥ã®ã‚¯ã‚¨ã‚¹ãƒˆå ±é…¬ã‚’é”æˆã—ãŸæ—¥ã«é…åˆ†
          let cumulativeWeekend = 0;
          let nextWeekendQuestIndex = 0;
          let cumulativeWeekendQuestCount = 0;

          weekends.forEach(day => {
            const dayData = hours[day];
            const dayDeliveries = dayData.deliveries > 0 ? dayData.deliveries : dayData.hours * effectiveValues.weekendDeliveriesPerHour;
            cumulativeWeekend += dayDeliveries;

            // ã“ã®æ—¥ã«é”æˆã—ãŸã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¢ºèª
            let dayQuestReward = 0;
            while (nextWeekendQuestIndex < weekendQuests.length) {
              const nextThreshold = cumulativeWeekendQuestCount + weekendQuests[nextWeekendQuestIndex].count;
              if (cumulativeWeekend >= nextThreshold) {
                dayQuestReward += weekendQuests[nextWeekendQuestIndex].reward;
                cumulativeWeekendQuestCount = nextThreshold;
                nextWeekendQuestIndex++;
              } else {
                break;
              }
            }

            // ã“ã®æ—¥ã«ã‚¯ã‚¨ã‚¹ãƒˆå ±é…¬ãŒã‚ã‚Šã€ã‹ã¤å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆã«è¨­å®š
            const dateStr = getDayDate(day);
            if (dateStr && dayQuestReward > 0 && updatedData[dateStr] &&
                updatedData[dateStr].hours > 0 &&
                updatedData[dateStr].deliveries > 0 &&
                updatedData[dateStr].earnings > 0) {
              // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã€å…¨ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚Œã°ã‚¯ã‚¨ã‚¹ãƒˆã‚’è¿½åŠ 
              updatedData[dateStr] = {
                ...updatedData[dateStr],
                quest: dayQuestReward
              };
            }
          });

          return updatedData;
        });
      }, [hours, weekdayQuests, weekendQuests, currentWeekStart, weekdayDeliveriesPerHour, weekendDeliveriesPerHour, useAutoCalculate, weekdayAvgPrice, weekendAvgPrice]);

      // é€±ã®åˆ‡ã‚Šæ›¿ã‚ã‚Šæ¤œçŸ¥ï¼ˆæ—¥æ›œæ—¥â†’æœˆæ›œæ—¥ï¼‰
      useEffect(() => {
        const checkWeekTransition = () => {
          const today = new Date();
          const todayStr = formatDateToLocal(today);
          const dayOfWeek = today.getDay(); // 0=æ—¥æ›œ, 1=æœˆæ›œ, ...

          // ä»Šæ—¥ã®æœˆæ›œæ—¥ã®æ—¥ä»˜ã‚’è¨ˆç®—
          const getMondayOfWeek = (date) => {
            const d = new Date(date);
            const day = d.getDay();
            const diff = day === 0 ? -6 : 1 - day; // æ—¥æ›œã®å ´åˆã¯å‰æ—¥ã®æœˆæ›œã€ãã‚Œä»¥å¤–ã¯ä»Šé€±ã®æœˆæ›œ
            d.setDate(d.getDate() + diff);
            return formatDateToLocal(d);
          };

          const mondayStr = getMondayOfWeek(today);

          // åˆå›ã‚¢ã‚¯ã‚»ã‚¹ã®å ´åˆ
          if (!lastAccessDate) {
            setLastAccessDate(todayStr);
            setCurrentWeekStart(mondayStr);
            return;
          }

          const lastAccess = new Date(lastAccessDate);
          const lastDayOfWeek = lastAccess.getDay();

          // æ—¥æ›œæ—¥ã‹ã‚‰æœˆæ›œæ—¥ã«å¤‰ã‚ã£ãŸå ´åˆï¼ˆæ–°ã—ã„é€±ã®é–‹å§‹ï¼‰
          if (lastDayOfWeek === 0 && dayOfWeek === 1) {
            // é€±ã®å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢ï¼ˆãƒ‡ãƒ¼ã‚¿ã¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«è‡ªå‹•ä¿å­˜æ¸ˆã¿ï¼‰
            setHours({
              æœˆ: { hours: 0, deliveries: 0, earnings: 0 },
              ç«: { hours: 0, deliveries: 0, earnings: 0 },
              æ°´: { hours: 0, deliveries: 0, earnings: 0 },
              æœ¨: { hours: 0, deliveries: 0, earnings: 0 },
              é‡‘: { hours: 0, deliveries: 0, earnings: 0 },
              åœŸ: { hours: 0, deliveries: 0, earnings: 0 },
              æ—¥: { hours: 0, deliveries: 0, earnings: 0 }
            });
          }

          // é€±ãŒå¤‰ã‚ã£ãŸå ´åˆï¼ˆæœˆæ›œæ—¥ã§ãªãã¦ã‚‚é€±ã®é–‹å§‹æ—¥ã‚’æ›´æ–°ï¼‰
          if (currentWeekStart !== mondayStr) {
            setCurrentWeekStart(mondayStr);
          }

          // æœ€çµ‚ã‚¢ã‚¯ã‚»ã‚¹æ—¥ã‚’æ›´æ–°
          setLastAccessDate(todayStr);
        };

        checkWeekTransition();
      }, []); // èµ·å‹•æ™‚ã«1å›ã ã‘å®Ÿè¡Œ

      // ã‚¯ã‚¨ã‚¹ãƒˆæ›´æ–° - æœˆï½æœ¨
      const updateWeekdayQuest = (index, field, value) => {
        const newQuests = [...weekdayQuests];
        newQuests[index][field] = parseFloat(value) || 0;
        setWeekdayQuests(newQuests);
      };

      // ã‚¯ã‚¨ã‚¹ãƒˆæ›´æ–° - é‡‘ï½æ—¥
      const updateWeekendQuest = (index, field, value) => {
        const newQuests = [...weekendQuests];
        newQuests[index][field] = parseFloat(value) || 0;
        setWeekendQuests(newQuests);
      };
      
      // æ›œæ—¥ã‹ã‚‰æ—¥ä»˜ã‚’è¨ˆç®—
      const getDayDate = (dayName) => {
        if (!currentWeekStart) return null;

        const dayIndex = days.indexOf(dayName); // 0=æœˆ, 1=ç«, ..., 6=æ—¥
        const weekStartDate = new Date(currentWeekStart + 'T00:00:00');
        const targetDate = new Date(weekStartDate);
        targetDate.setDate(targetDate.getDate() + dayIndex);

        return formatDateToLocal(targetDate);
      };

      // ç¨¼åƒæ™‚é–“æ›´æ–°ï¼ˆé€±ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°ã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¸ã®åæ˜ ã¯useEffectã§è‡ªå‹•å®Ÿè¡Œï¼‰
      const updateHours = (day, field, value) => {
        const newValue = parseFloat(value) || 0;

        // é€±ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
        setHours({
          ...hours,
          [day]: {
            ...hours[day],
            [field]: newValue
          }
        });
      };

      // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
      const exportData = () => {
        const data = {
          version: 2,
          exportDate: new Date().toISOString(),
          weekdayAvgPrice,
          weekendAvgPrice,
          weekdayDeliveriesPerHour,
          weekendDeliveriesPerHour,
          useAutoCalculate,
          weekdayQuests,
          weekendQuests,
          hours,
          targetAmount,
          dailyData,
          currentWeekStart,
          lastAccessDate
        };

        const jsonStr = JSON.stringify(data, null, 2);
        const blob = new Blob([jsonStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `ubereats-backup-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      };

      // ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
      const importData = (event) => {
        try {
          const file = event.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = JSON.parse(e.target.result);

              // ãƒ‡ãƒ¼ã‚¿ã‚’localStorageã«ä¿å­˜
              if (data.weekdayAvgPrice !== undefined) localStorage.setItem('weekdayAvgPrice', String(data.weekdayAvgPrice));
              if (data.weekendAvgPrice !== undefined) localStorage.setItem('weekendAvgPrice', String(data.weekendAvgPrice));
              if (data.weekdayDeliveriesPerHour !== undefined) localStorage.setItem('weekdayDeliveriesPerHour', String(data.weekdayDeliveriesPerHour));
              if (data.weekendDeliveriesPerHour !== undefined) localStorage.setItem('weekendDeliveriesPerHour', String(data.weekendDeliveriesPerHour));
              if (data.useAutoCalculate !== undefined) localStorage.setItem('useAutoCalculate', JSON.stringify(data.useAutoCalculate));
              if (data.weekdayQuests) localStorage.setItem('weekdayQuests', JSON.stringify(data.weekdayQuests));
              if (data.weekendQuests) localStorage.setItem('weekendQuests', JSON.stringify(data.weekendQuests));
              if (data.hours) localStorage.setItem('hours', JSON.stringify(data.hours));
              if (data.targetAmount !== undefined) localStorage.setItem('targetAmount', String(data.targetAmount));
              if (data.dailyData) localStorage.setItem('dailyData', JSON.stringify(data.dailyData));
              if (data.currentWeekStart) localStorage.setItem('currentWeekStart', data.currentWeekStart);
              if (data.lastAccessDate) localStorage.setItem('lastAccessDate', data.lastAccessDate);

              // stateã‚’ç›´æ¥æ›´æ–°
              if (data.weekdayAvgPrice !== undefined) setWeekdayAvgPrice(data.weekdayAvgPrice);
              if (data.weekendAvgPrice !== undefined) setWeekendAvgPrice(data.weekendAvgPrice);
              if (data.weekdayDeliveriesPerHour !== undefined) setWeekdayDeliveriesPerHour(data.weekdayDeliveriesPerHour);
              if (data.weekendDeliveriesPerHour !== undefined) setWeekendDeliveriesPerHour(data.weekendDeliveriesPerHour);
              if (data.useAutoCalculate !== undefined) setUseAutoCalculate(data.useAutoCalculate);
              if (data.weekdayQuests) setWeekdayQuests(data.weekdayQuests);
              if (data.weekendQuests) setWeekendQuests(data.weekendQuests);
              if (data.hours) setHours(data.hours);
              if (data.targetAmount !== undefined) setTargetAmount(data.targetAmount);
              if (data.dailyData) setDailyData(data.dailyData);
              if (data.currentWeekStart) setCurrentWeekStart(data.currentWeekStart);
              if (data.lastAccessDate) setLastAccessDate(data.lastAccessDate);

              // inputè¦ç´ ã‚’ãƒªã‚»ãƒƒãƒˆ
              if (event.target) event.target.value = '';

              alert('ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸï¼');
            } catch (error) {
              console.error('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
              alert('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
              if (event.target) event.target.value = '';
            }
          };
          reader.onerror = () => {
            alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
            if (event.target) event.target.value = '';
          };
          reader.readAsText(file);
        } catch (error) {
          console.error('ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
          alert('ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
        }
      };

      // æ—¥ä»˜ã‚’ã‚¿ãƒƒãƒ—ã—ãŸã¨ãã®å‡¦ç†
      const handleDateClick = (date) => {
        const dateStr = formatDateToLocal(date);

        // æ—¥ä»˜å¤‰æ›´ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ
        if (isChangingDate) {
          // é¸æŠã—ãŸæ—¥ä»˜ã«æ—¢ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
          if (dailyData[dateStr] && dailyData[dateStr].hours > 0) {
            if (!confirm('ã“ã®æ—¥ä»˜ã«ã¯æ—¢ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã™ã€‚å…ƒã®ãƒ‡ãƒ¼ã‚¿ã¯å‰Šé™¤ã•ã‚Œã€ç·¨é›†ä¸­ã®ãƒ‡ãƒ¼ã‚¿ãŒç§»å‹•ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
              return; // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸå ´åˆã¯ä½•ã‚‚ã—ãªã„
            }
          }

          setSelectedDate(dateStr);
          setShowCalendar(false);
          setIsChangingDate(false);
          setShowDayEdit(true);
          return;
        }

        // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰
        setSelectedDate(dateStr);
        setOriginalSelectedDate(dateStr); // å…ƒã®æ—¥ä»˜ã‚’ä¿å­˜

        // ãã®æ—¥ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        const dayData = dailyData[dateStr] || { hours: 0, deliveries: 0, earnings: 0, quest: 0 };
        setEditingDayData(dayData);
        setShowDayEdit(true);
      };

      // æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜
      const saveDayData = () => {
        if (!selectedDate) return;

        setDailyData(prev => {
          const newData = { ...prev };

          // æ—¥ä»˜ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã€å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
          if (originalSelectedDate && originalSelectedDate !== selectedDate) {
            delete newData[originalSelectedDate];
            // æ–°ã—ã„æ—¥ä»˜ã«ã‚‚ãƒ‡ãƒ¼ã‚¿ãŒã‚ã£ãŸå ´åˆã¯ã€ãã‚Œã‚‚å‰Šé™¤ã•ã‚Œã‚‹ï¼ˆä¸Šæ›¸ãï¼‰
            if (newData[selectedDate]) {
              delete newData[selectedDate];
            }
          }

          // æ–°ã—ã„æ—¥ä»˜ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
          newData[selectedDate] = { ...editingDayData };

          return newData;
        });

        setShowDayEdit(false);
        setSelectedDate(null);
        setOriginalSelectedDate(null);
      };

      // æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤
      const deleteDayData = () => {
        if (!selectedDate) return;

        const newData = { ...dailyData };
        delete newData[selectedDate];
        setDailyData(newData);

        setShowDayEdit(false);
        setSelectedDate(null);
        setOriginalSelectedDate(null);
      };

      // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æœˆã‚’å¤‰æ›´
      const changeMonth = (offset) => {
        const newMonth = new Date(currentMonth);
        newMonth.setMonth(newMonth.getMonth() + offset);
        setCurrentMonth(newMonth);
      };

      // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜é…åˆ—ã‚’ç”Ÿæˆ
      const generateCalendarDays = () => {
        const year = currentMonth.getFullYear();
        const month = currentMonth.getMonth();

        // æœˆã®æœ€åˆã®æ—¥
        const firstDay = new Date(year, month, 1);
        // æœˆã®æœ€å¾Œã®æ—¥
        const lastDay = new Date(year, month + 1, 0);

        // æœ€åˆã®æ—¥ã®æ›œæ—¥ï¼ˆ0=æ—¥æ›œ, 1=æœˆæ›œ, ...ï¼‰
        let firstDayOfWeek = firstDay.getDay();
        // æœˆæ›œå§‹ã¾ã‚Šã«èª¿æ•´ï¼ˆæ—¥æ›œ=6, æœˆæ›œ=0ï¼‰
        firstDayOfWeek = firstDayOfWeek === 0 ? 6 : firstDayOfWeek - 1;

        const days = [];

        // å‰æœˆã®æ—¥ä»˜ã§åŸ‹ã‚ã‚‹
        const prevMonthLastDay = new Date(year, month, 0).getDate();
        for (let i = firstDayOfWeek - 1; i >= 0; i--) {
          const date = new Date(year, month - 1, prevMonthLastDay - i);
          days.push({ date, isCurrentMonth: false });
        }

        // å½“æœˆã®æ—¥ä»˜
        for (let i = 1; i <= lastDay.getDate(); i++) {
          const date = new Date(year, month, i);
          days.push({ date, isCurrentMonth: true });
        }

        // æ¬¡æœˆã®æ—¥ä»˜ã§åŸ‹ã‚ã‚‹ï¼ˆ6é€±åˆ†=42æ—¥ã¾ã§ï¼‰
        const remainingDays = 42 - days.length;
        for (let i = 1; i <= remainingDays; i++) {
          const date = new Date(year, month + 1, i);
          days.push({ date, isCurrentMonth: false });
        }

        return days;
      };

      // Enterã‚­ãƒ¼ã§æ¬¡ã®é …ç›®ã«ç§»å‹•
      const handleKeyDown = (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          const form = e.target.form || e.target.closest('.space-y-2, .space-y-3, .space-y-4, .p-6');
          if (form) {
            const inputs = Array.from(form.querySelectorAll('input'));
            const index = inputs.indexOf(e.target);
            if (index >= 0 && index < inputs.length - 1) {
              inputs[index + 1].focus();
              inputs[index + 1].select();
            } else if (index === inputs.length - 1) {
              // æœ€å¾Œã®é …ç›®ã§ã¯ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’é–‰ã˜ã‚‹
              e.target.blur();
            }
          }
        }
      };

      // è¨ˆç®—
      const calculate = () => {
        // ä½¿ç”¨ã™ã‚‹å¹³å‡å€¤ã‚’å–å¾—
        const effectiveValues = getEffectiveValues();
        // æœˆï½æœ¨ã®åˆè¨ˆ
        let weekdayHours = 0;
        let weekdayDeliveries = 0;
        let weekdayBasicEarnings = 0;

        weekdays.forEach(day => {
          const dayData = hours[day];
          weekdayHours += dayData.hours;

          // ä»¶æ•°ï¼šå…¥åŠ›ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°äºˆæƒ³
          const dayDeliveries = dayData.deliveries > 0 ? dayData.deliveries : dayData.hours * effectiveValues.weekdayDeliveriesPerHour;
          weekdayDeliveries += dayDeliveries;

          // é‡‘é¡ï¼šå…¥åŠ›ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°äºˆæƒ³
          const dayEarnings = dayData.earnings > 0 ? dayData.earnings : dayData.hours * effectiveValues.weekdayDeliveriesPerHour * effectiveValues.weekdayAvgPrice;
          weekdayBasicEarnings += dayEarnings;
        });
        
        // æœˆï½æœ¨ã®ã‚¯ã‚¨ã‚¹ãƒˆå ±é…¬
        let weekdayQuestEarnings = 0;
        let cumulativeWeekday = 0;
        weekdayQuests.forEach(quest => {
          cumulativeWeekday += quest.count;
          if (weekdayDeliveries >= cumulativeWeekday) {
            weekdayQuestEarnings += quest.reward;
          }
        });
        
        // é‡‘ï½æ—¥ã®åˆè¨ˆ
        let weekendHours = 0;
        let weekendDeliveries = 0;
        let weekendBasicEarnings = 0;
        
        weekends.forEach(day => {
          const dayData = hours[day];
          weekendHours += dayData.hours;

          // ä»¶æ•°ï¼šå…¥åŠ›ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°äºˆæƒ³
          const dayDeliveries = dayData.deliveries > 0 ? dayData.deliveries : dayData.hours * effectiveValues.weekendDeliveriesPerHour;
          weekendDeliveries += dayDeliveries;

          // é‡‘é¡ï¼šå…¥åŠ›ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°äºˆæƒ³
          const dayEarnings = dayData.earnings > 0 ? dayData.earnings : dayData.hours * effectiveValues.weekendDeliveriesPerHour * effectiveValues.weekendAvgPrice;
          weekendBasicEarnings += dayEarnings;
        });
        
        // é‡‘ï½æ—¥ã®ã‚¯ã‚¨ã‚¹ãƒˆå ±é…¬
        let weekendQuestEarnings = 0;
        let cumulativeWeekend = 0;
        weekendQuests.forEach(quest => {
          cumulativeWeekend += quest.count;
          if (weekendDeliveries >= cumulativeWeekend) {
            weekendQuestEarnings += quest.reward;
          }
        });
        
        // é€±ã®åˆè¨ˆ
        const totalHours = weekdayHours + weekendHours;
        const totalDeliveries = weekdayDeliveries + weekendDeliveries;
        const basicEarnings = weekdayBasicEarnings + weekendBasicEarnings;
        const questEarnings = weekdayQuestEarnings + weekendQuestEarnings;
        const totalEarnings = basicEarnings + questEarnings;
        
        // 1æ—¥ã‚ãŸã‚Šã®å¹³å‡
        const daysWorked = Object.values(hours).filter(h => h.hours > 0).length;
        const avgPerDay = daysWorked > 0 ? totalEarnings / daysWorked : 0;
        
        // å¹³å‡æ™‚çµ¦
        const avgHourlyWage = totalHours > 0 ? totalEarnings / totalHours : 0;
        
        // ç›®æ¨™é”æˆã«å¿…è¦ãªæ™‚é–“
        let hoursNeeded = 0;
        if (targetAmount > 0 && totalEarnings < targetAmount && avgHourlyWage > 0) {
          const remaining = targetAmount - totalEarnings;
          hoursNeeded = remaining / avgHourlyWage;
        }
        
        return {
          totalHours: totalHours.toFixed(1),
          weekdayHours: weekdayHours.toFixed(1),
          weekendHours: weekendHours.toFixed(1),
          totalDeliveries: Math.floor(totalDeliveries),
          weekdayDeliveries: Math.floor(weekdayDeliveries),
          weekendDeliveries: Math.floor(weekendDeliveries),
          basicEarnings: Math.floor(basicEarnings),
          questEarnings: Math.floor(questEarnings),
          totalEarnings: Math.floor(totalEarnings),
          avgPerDay: Math.floor(avgPerDay),
          avgHourlyWage: Math.floor(avgHourlyWage),
          hoursNeeded: hoursNeeded.toFixed(1),
          daysWorked
        };
      };
      
      const results = calculate();
      
      return (
        <div className="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 p-4 pb-20">
          <div className="max-w-2xl mx-auto">
            {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
            <div className="bg-white rounded-2xl shadow-lg p-6 mb-4">
              <div className="flex items-center justify-between mb-2">
                <div className="flex items-center gap-3">
                  <button
                    onClick={() => setShowTotalStats(true)}
                    className="bg-green-500 p-3 rounded-xl hover:bg-green-600 transition-colors"
                  >
                    <Calculator />
                  </button>
                  <div>
                    <h1 className="text-2xl font-bold text-gray-800">Uber Eats</h1>
                    <p className="text-sm text-gray-600">é€±é–“å£²ä¸Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</p>
                  </div>
                </div>
                <button
                  onClick={() => setShowBasicSettings(true)}
                  className="bg-blue-500 text-white px-3 py-2 rounded-lg font-medium hover:bg-blue-600 transition-colors text-xs"
                >
                  âš™ï¸ è¨­å®š
                </button>
              </div>

              {/* ã‚¯ã‚¨ã‚¹ãƒˆã¨ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒœã‚¿ãƒ³ */}
              <div className="grid grid-cols-2 gap-2 mt-4">
                <button
                  onClick={() => setShowQuestSettings(true)}
                  className="bg-yellow-500 text-white px-3 py-3 rounded-xl font-medium hover:bg-yellow-600 transition-colors text-sm"
                >
                  ğŸ† ã‚¯ã‚¨ã‚¹ãƒˆ
                </button>
                <button
                  onClick={() => setShowCalendar(true)}
                  className="bg-purple-500 text-white px-3 py-3 rounded-xl font-medium hover:bg-purple-600 transition-colors text-sm"
                >
                  ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
                </button>
              </div>
            </div>
            
            {/* ç›®æ¨™é‡‘é¡è¨­å®š */}
            <div className="bg-white rounded-2xl shadow-lg p-6 mb-4">
              <h2 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                <DollarSign />
                ç›®æ¨™é‡‘é¡
              </h2>
              
              <div className="flex items-center gap-3">
                <input
                  type="number"
                  step="1000"
                  value={targetAmount || ''}
                  onChange={(e) => setTargetAmount(parseFloat(e.target.value) || 0)}
                  onKeyDown={handleKeyDown}
                  className="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:outline-none text-lg"
                  placeholder="ç›®æ¨™é‡‘é¡ã‚’å…¥åŠ›"
                />
                <span className="text-gray-600 font-medium">å††</span>
              </div>
            </div>
            
            {/* ç¨¼åƒæ™‚é–“å…¥åŠ› */}
            <div className="bg-white rounded-2xl shadow-lg p-6 mb-4">
              <h2 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                <Package />
                1æ—¥ã®ç¨¼åƒæ™‚é–“
              </h2>
              
              <div className="space-y-2">
                <div className="flex items-center gap-2">
                  <div className="w-8"></div>
                  <div className="grid grid-cols-3 gap-2 flex-1 text-xs text-gray-600 font-medium">
                    <div className="text-center">æ™‚é–“</div>
                    <div className="text-center">ä»¶æ•°</div>
                    <div className="text-center">é‡‘é¡</div>
                  </div>
                </div>
                {days.map(day => (
                  <div key={day} className="flex items-center gap-2">
                    <div className="font-medium text-gray-700 w-8">{day}</div>
                    <div className="grid grid-cols-3 gap-2 flex-1">
                      <input
                        type="number"
                        step="0.2"
                        value={hours[day].hours || ''}
                        onChange={(e) => updateHours(day, 'hours', e.target.value)}
                        onKeyDown={handleKeyDown}
                        className="w-full px-2 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-sm text-center"
                        placeholder="0"
                      />
                      <input
                        type="number"
                        value={hours[day].deliveries || ''}
                        onChange={(e) => updateHours(day, 'deliveries', e.target.value)}
                        onKeyDown={handleKeyDown}
                        className="w-full px-2 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-sm text-center"
                        placeholder={hours[day].hours > 0 ? (() => {
                          const effectiveValues = getEffectiveValues();
                          const isWeekday = weekdays.includes(day);
                          const deliveries = isWeekday ? effectiveValues.weekdayDeliveriesPerHour : effectiveValues.weekendDeliveriesPerHour;
                          return Math.floor(hours[day].hours * deliveries).toString();
                        })() : "0"}
                      />
                      <input
                        type="number"
                        step="10"
                        value={hours[day].earnings || ''}
                        onChange={(e) => updateHours(day, 'earnings', e.target.value)}
                        onKeyDown={handleKeyDown}
                        className="w-full px-2 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-sm text-center"
                        placeholder={hours[day].hours > 0 ? (() => {
                          const effectiveValues = getEffectiveValues();
                          const isWeekday = weekdays.includes(day);
                          const price = isWeekday ? effectiveValues.weekdayAvgPrice : effectiveValues.weekendAvgPrice;
                          const deliveries = isWeekday ? effectiveValues.weekdayDeliveriesPerHour : effectiveValues.weekendDeliveriesPerHour;
                          return Math.floor(hours[day].hours * deliveries * price).toString();
                        })() : "0"}
                      />
                    </div>
                  </div>
                ))}
              </div>
              
              <div className="mt-4 p-3 bg-blue-50 rounded-lg">
                <p className="text-xs text-gray-600">
                  ğŸ’¡ æ™‚é–“ã®ã¿å…¥åŠ›ã§äºˆæƒ³é‡‘é¡ã‚’è¨ˆç®—<br/>
                  ã™ã¹ã¦å…¥åŠ›ã§å®Ÿç¸¾å€¤ã‚’åæ˜ 
                </p>
              </div>
            </div>
            
            {/* çµæœè¡¨ç¤º */}
            <div className="bg-gradient-to-br from-green-500 to-blue-500 rounded-2xl shadow-xl p-6 text-white mb-4">
              <h2 className="text-xl font-bold mb-6">é€±é–“å£²ä¸Šäºˆæ¸¬</h2>
              
              <div className="space-y-4">
                {/* åˆè¨ˆç¨¼åƒæ™‚é–“ã¨åˆè¨ˆé…é”ä»¶æ•° */}
                <div className="grid grid-cols-2 gap-3">
                  <div className="bg-white/20 backdrop-blur-sm rounded-xl p-4">
                    <div className="text-sm opacity-90 mb-1">åˆè¨ˆç¨¼åƒæ™‚é–“</div>
                    <div className="text-2xl font-bold">{results.totalHours} æ™‚é–“</div>
                    <div className="text-xs opacity-80 mt-2">
                      <div>æœˆï½æœ¨: {results.weekdayHours}æ™‚é–“</div>
                      <div>é‡‘ï½æ—¥: {results.weekendHours}æ™‚é–“</div>
                    </div>
                  </div>

                  <div className="bg-white/20 backdrop-blur-sm rounded-xl p-4">
                    <div className="text-sm opacity-90 mb-1">åˆè¨ˆé…é”ä»¶æ•°</div>
                    <div className="text-2xl font-bold">{results.totalDeliveries} ä»¶</div>
                    <div className="text-xs opacity-80 mt-2">
                      <div>æœˆï½æœ¨: {results.weekdayDeliveries}ä»¶</div>
                      <div>é‡‘ï½æ—¥: {results.weekendDeliveries}ä»¶</div>
                    </div>
                  </div>
                </div>

                {/* åŸºæœ¬å£²ä¸Šã¨ã‚¯ã‚¨ã‚¹ãƒˆå ±é…¬ */}
                <div className="grid grid-cols-2 gap-3">
                  <div className="bg-white/20 backdrop-blur-sm rounded-xl p-4">
                    <div className="text-sm opacity-90 mb-1">åŸºæœ¬å£²ä¸Š</div>
                    <div className="text-2xl font-bold">Â¥{results.basicEarnings.toLocaleString()}</div>
                  </div>

                  <div className="bg-white/20 backdrop-blur-sm rounded-xl p-4">
                    <div className="text-sm opacity-90 mb-1">ã‚¯ã‚¨ã‚¹ãƒˆå ±é…¬</div>
                    <div className="text-2xl font-bold">Â¥{results.questEarnings.toLocaleString()}</div>
                  </div>
                </div>
                
                <div className="bg-white/30 backdrop-blur-sm rounded-xl p-5 border-2 border-white/50">
                  <div className="text-sm opacity-90 mb-1">é€±é–“åˆè¨ˆå£²ä¸Š</div>
                  <div className="text-4xl font-bold">Â¥{results.totalEarnings.toLocaleString()}</div>
                </div>
                
                {/* 1æ—¥å¹³å‡ã¨å¹³å‡æ™‚çµ¦ */}
                {(results.daysWorked > 0 || parseFloat(results.totalHours) > 0) && (
                  <div className="grid grid-cols-2 gap-3">
                    {results.daysWorked > 0 && (
                      <div className="bg-white/20 backdrop-blur-sm rounded-xl p-4">
                        <div className="text-sm opacity-90 mb-1">1æ—¥å¹³å‡({results.daysWorked}æ—¥ç¨¼åƒ)</div>
                        <div className="text-2xl font-bold">Â¥{results.avgPerDay.toLocaleString()}</div>
                      </div>
                    )}

                    {parseFloat(results.totalHours) > 0 && (
                      <div className="bg-white/20 backdrop-blur-sm rounded-xl p-4">
                        <div className="text-sm opacity-90 mb-1">å¹³å‡æ™‚çµ¦</div>
                        <div className="text-2xl font-bold">Â¥{results.avgHourlyWage.toLocaleString()}</div>
                      </div>
                    )}
                  </div>
                )}
                
                {targetAmount > 0 && results.totalEarnings < targetAmount && parseFloat(results.hoursNeeded) > 0 && (
                  <div className="bg-red-500/30 backdrop-blur-sm rounded-xl p-4 border-2 border-red-400">
                    <div className="text-sm opacity-90 mb-1">ç›®æ¨™é”æˆã¾ã§</div>
                    <div className="text-2xl font-bold">ã‚ã¨ {results.hoursNeeded} æ™‚é–“</div>
                    <div className="text-xs opacity-80 mt-1">æ®‹ã‚Š Â¥{(targetAmount - results.totalEarnings).toLocaleString()}</div>
                  </div>
                )}
                
                {targetAmount > 0 && results.totalEarnings >= targetAmount && (
                  <div className="bg-yellow-500/30 backdrop-blur-sm rounded-xl p-4 border-2 border-yellow-400">
                    <div className="text-2xl font-bold">ğŸ‰ ç›®æ¨™é”æˆï¼</div>
                    <div className="text-sm opacity-90 mt-1">ç›®æ¨™ Â¥{targetAmount.toLocaleString()} é”æˆ</div>
                  </div>
                )}
              </div>
            </div>

            {/* å…¨æœŸé–“é›†è¨ˆãƒ¢ãƒ¼ãƒ€ãƒ« */}
            {showTotalStats && (
              <div className="fixed inset-0 bg-white z-50 flex flex-col overscroll-contain">
                <div className="bg-white w-full h-full flex flex-col">
                  <div className="bg-white border-b border-gray-200 p-4 flex items-center justify-between flex-shrink-0">
                    <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                      <Calculator />
                      <span>å…¨æœŸé–“é›†è¨ˆã€{Object.keys(dailyData || {}).length}æ—¥ã€‘</span>
                    </h2>
                    <button
                      onClick={() => setShowTotalStats(false)}
                      className="text-gray-500 hover:text-gray-700 text-2xl"
                    >
                      Ã—
                    </button>
                  </div>

                  {/* ã‚¿ãƒ– */}
                  <div className="flex border-b border-gray-200 flex-shrink-0">
                    <button
                      onClick={() => setTotalStatsTab('summary')}
                      className={`flex-1 py-3 text-sm font-medium transition-colors ${
                        totalStatsTab === 'summary'
                          ? 'text-green-600 border-b-2 border-green-600 bg-green-50'
                          : 'text-gray-600 hover:text-gray-800 hover:bg-gray-50'
                      }`}
                    >
                      ç·åˆè¨ˆ
                    </button>
                    <button
                      onClick={() => setTotalStatsTab('daily')}
                      className={`flex-1 py-3 text-sm font-medium transition-colors ${
                        totalStatsTab === 'daily'
                          ? 'text-green-600 border-b-2 border-green-600 bg-green-50'
                          : 'text-gray-600 hover:text-gray-800 hover:bg-gray-50'
                      }`}
                    >
                      æ›œæ—¥åˆ¥å¹³å‡
                    </button>
                  </div>

                  <div className="p-6 overflow-y-auto flex-1">
                    {(() => {
                      try {
                        const allEntries = Object.entries(dailyData || {});
                        if (allEntries.length === 0) {
                          return (
                            <div className="text-center text-gray-500 py-8">
                              ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“
                            </div>
                          );
                        }

                        // ç·åˆè¨ˆã‚¿ãƒ–
                        if (totalStatsTab === 'summary') {
                          let totalHours = 0;
                          let totalDeliveries = 0;
                          let totalEarnings = 0;
                          let totalQuest = 0;

                          allEntries.forEach(([, data]) => {
                            if (data) {
                              totalHours += data.hours || 0;
                              totalDeliveries += data.deliveries || 0;
                              totalEarnings += data.earnings || 0;
                              totalQuest += data.quest || 0;
                            }
                          });

                          const totalSales = totalEarnings + totalQuest;
                          const avgPricePerDelivery = totalDeliveries > 0 ? totalEarnings / totalDeliveries : 0;
                          const deliveriesPerHour = totalHours > 0 ? totalDeliveries / totalHours : 0;
                          const earningsPerHour = totalHours > 0 ? totalSales / totalHours : 0;

                          return (
                        <div className="space-y-4">
                          {/* åˆè¨ˆå£²ä¸Š */}
                          <div className="bg-green-50 rounded-xl p-4 border-2 border-green-200">
                            <div className="text-sm text-gray-600 mb-1">åˆè¨ˆå£²ä¸Š</div>
                            <div className="text-2xl font-bold text-green-600">
                              Â¥{Math.floor(totalSales).toLocaleString()}
                            </div>
                            <div className="text-xs text-gray-500 mt-1">
                              åŸºæœ¬: Â¥{Math.floor(totalEarnings).toLocaleString()} + ã‚¯ã‚¨ã‚¹ãƒˆ: Â¥{Math.floor(totalQuest).toLocaleString()}
                            </div>
                          </div>

                          {/* ç·ç¨¼åƒæ™‚é–“ã¨ç·é…é”ä»¶æ•° */}
                          <div className="grid grid-cols-2 gap-3">
                            <div className="bg-blue-50 rounded-xl p-4">
                              <div className="text-sm text-gray-600 mb-1">ç·ç¨¼åƒæ™‚é–“</div>
                              <div className="text-xl font-bold text-blue-600">
                                {totalHours.toFixed(1)}æ™‚é–“
                              </div>
                            </div>

                            <div className="bg-purple-50 rounded-xl p-4">
                              <div className="text-sm text-gray-600 mb-1">ç·é…é”ä»¶æ•°</div>
                              <div className="text-xl font-bold text-purple-600">
                                {totalDeliveries}ä»¶
                              </div>
                            </div>
                          </div>

                          {/* å¹³å‡å€¤ */}
                          <div className="bg-gray-50 rounded-xl p-4 space-y-2">
                            <div className="text-sm font-medium text-gray-700 mb-2">ğŸ“Š å¹³å‡å€¤</div>
                            <div className="grid grid-cols-2 gap-3 text-sm">
                              <div>
                                <div className="text-gray-600">å¹³å‡å˜ä¾¡</div>
                                <div className="font-bold text-gray-800">Â¥{Math.floor(avgPricePerDelivery).toLocaleString()}/ä»¶</div>
                              </div>
                              <div>
                                <div className="text-gray-600">æ™‚çµ¦æ›ç®—</div>
                                <div className="font-bold text-gray-800">Â¥{Math.floor(earningsPerHour).toLocaleString()}/h</div>
                              </div>
                              <div>
                                <div className="text-gray-600">é…é”ä»¶æ•°</div>
                                <div className="font-bold text-gray-800">{deliveriesPerHour.toFixed(1)}ä»¶/h</div>
                              </div>
                              <div>
                                <div className="text-gray-600">æ—¥å¹³å‡å£²ä¸Š</div>
                                <div className="font-bold text-gray-800">Â¥{Math.floor(totalSales / allEntries.length).toLocaleString()}/æ—¥</div>
                              </div>
                            </div>
                          </div>
                        </div>
                          );
                        }

                        // æ›œæ—¥åˆ¥å¹³å‡ã‚¿ãƒ–
                        if (totalStatsTab === 'daily') {
                          // æ›œæ—¥ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆ
                          const dayOfWeekData = [0, 1, 2, 3, 4, 5, 6].map(dow => ({
                            dow,
                            hours: 0,
                            deliveries: 0,
                            earnings: 0,
                            quest: 0,
                            count: 0
                          }));

                          allEntries.forEach(([dateStr, data]) => {
                            if (data) {
                              const date = new Date(dateStr + 'T00:00:00');
                              const dow = date.getDay(); // 0=æ—¥, 1=æœˆ, ..., 6=åœŸ
                              dayOfWeekData[dow].hours += data.hours || 0;
                              dayOfWeekData[dow].deliveries += data.deliveries || 0;
                              dayOfWeekData[dow].earnings += data.earnings || 0;
                              dayOfWeekData[dow].quest += data.quest || 0;
                              dayOfWeekData[dow].count += 1;
                            }
                          });

                          const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];

                          // æœˆæ›œæ—¥å§‹ã¾ã‚Šã«ä¸¦ã³æ›¿ãˆ: [æœˆ1, ç«2, æ°´3, æœ¨4, é‡‘5, åœŸ6, æ—¥0]
                          const sortedDayData = [1, 2, 3, 4, 5, 6, 0].map(dow => dayOfWeekData[dow]);

                          // ã‚°ãƒ©ãƒ•ç”¨ã®æœ€å¤§å€¤ã‚’è¨ˆç®—
                          const maxHourlyWage = Math.max(...sortedDayData.map(d => {
                            if (d.count === 0) return 0;
                            return d.hours > 0 ? (d.earnings + d.quest) / d.hours : 0;
                          }));

                          return (
                            <div className="space-y-4">
                              {/* å¹³å‡æ™‚çµ¦ã‚°ãƒ©ãƒ• */}
                              <div className="bg-gradient-to-br from-green-50 to-blue-50 rounded-xl p-4 border border-green-200">
                                <div className="text-sm font-medium text-gray-700 mb-3">ğŸ“Š å¹³å‡æ™‚çµ¦ã‚°ãƒ©ãƒ•</div>
                                <div className="space-y-2">
                                  {sortedDayData.map((dayData, idx) => {
                                    if (dayData.count === 0) return null;
                                    const avgHourlyWage = dayData.hours > 0 ? (dayData.earnings + dayData.quest) / dayData.hours : 0;
                                    const widthPercent = maxHourlyWage > 0 ? (avgHourlyWage / maxHourlyWage) * 100 : 0;

                                    return (
                                      <div key={dayData.dow} className="flex items-center gap-2">
                                        <div className="text-xs font-medium text-gray-700 w-6">{dayNames[dayData.dow]}</div>
                                        <div className="flex-1 bg-white rounded-full h-6 overflow-hidden">
                                          <div
                                            className="bg-gradient-to-r from-green-500 to-blue-500 h-full rounded-full flex items-center justify-end pr-2 transition-all duration-300"
                                            style={{ width: `${widthPercent}%` }}
                                          >
                                            {widthPercent > 20 && (
                                              <span className="text-xs font-bold text-white">Â¥{Math.floor(avgHourlyWage).toLocaleString()}</span>
                                            )}
                                          </div>
                                        </div>
                                        {widthPercent <= 20 && (
                                          <span className="text-xs font-bold text-gray-700 w-16">Â¥{Math.floor(avgHourlyWage).toLocaleString()}</span>
                                        )}
                                      </div>
                                    );
                                  })}
                                </div>
                              </div>

                              {/* æ›œæ—¥åˆ¥è©³ç´° */}
                              {sortedDayData.map(dayData => {
                                if (dayData.count === 0) return null;

                                const avgHours = dayData.hours / dayData.count;
                                const avgDeliveries = dayData.deliveries / dayData.count;
                                const avgEarnings = dayData.earnings / dayData.count;
                                const avgQuest = dayData.quest / dayData.count;
                                const avgTotal = avgEarnings + avgQuest;
                                const avgPrice = dayData.deliveries > 0 ? dayData.earnings / dayData.deliveries : 0;
                                const avgDeliveriesPerHour = dayData.hours > 0 ? dayData.deliveries / dayData.hours : 0;
                                const avgHourlyWage = dayData.hours > 0 ? (dayData.earnings + dayData.quest) / dayData.hours : 0;

                                return (
                                  <div key={dayData.dow} className="bg-gray-50 rounded-xl p-4">
                                    <div className="font-bold text-gray-800 mb-3 flex items-center justify-between">
                                      <span>{dayNames[dayData.dow]}æ›œæ—¥</span>
                                      <span className="text-xs text-gray-500">{dayData.count}æ—¥åˆ†</span>
                                    </div>
                                    <div className="grid grid-cols-2 gap-3 text-sm">
                                      <div>
                                        <div className="text-gray-600">å¹³å‡ç¨¼åƒæ™‚é–“</div>
                                        <div className="font-bold text-gray-800">{avgHours.toFixed(1)}æ™‚é–“</div>
                                      </div>
                                      <div>
                                        <div className="text-gray-600">å¹³å‡é…é”ä»¶æ•°</div>
                                        <div className="font-bold text-gray-800">{avgDeliveries.toFixed(1)}ä»¶</div>
                                      </div>
                                      <div>
                                        <div className="text-gray-600">å¹³å‡å˜ä¾¡</div>
                                        <div className="font-bold text-gray-800">Â¥{Math.floor(avgPrice).toLocaleString()}/ä»¶</div>
                                      </div>
                                      <div>
                                        <div className="text-gray-600">å¹³å‡æ™‚çµ¦</div>
                                        <div className="font-bold text-green-600">Â¥{Math.floor(avgHourlyWage).toLocaleString()}/h</div>
                                      </div>
                                      <div>
                                        <div className="text-gray-600">æ™‚é–“é…é”ä»¶æ•°</div>
                                        <div className="font-bold text-gray-800">{avgDeliveriesPerHour.toFixed(1)}ä»¶/h</div>
                                      </div>
                                      <div>
                                        <div className="text-gray-600">å¹³å‡å£²ä¸Š</div>
                                        <div className="font-bold text-gray-800">Â¥{Math.floor(avgTotal).toLocaleString()}</div>
                                      </div>
                                    </div>
                                  </div>
                                );
                              })}
                            </div>
                          );
                        }

                        return null;
                      } catch (error) {
                        console.error('å…¨æœŸé–“é›†è¨ˆã‚¨ãƒ©ãƒ¼:', error);
                        return (
                          <div className="text-center text-red-500 py-8">
                            <div className="font-bold mb-2">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</div>
                            <div className="text-sm">{error.message}</div>
                          </div>
                        );
                      }
                    })()}
                  </div>

                  <div className="p-4 border-t border-gray-200 flex-shrink-0">
                    <button
                      onClick={() => setShowTotalStats(false)}
                      className="w-full bg-green-500 text-white py-3 rounded-xl font-medium hover:bg-green-600 transition-colors"
                    >
                      é–‰ã˜ã‚‹
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* ãƒ•ãƒƒã‚¿ãƒ¼ */}
            <div className="text-center text-gray-600 text-sm mt-6">
              â€»å®Ÿéš›ã®å£²ä¸Šã¯é…é”ã‚¨ãƒªã‚¢ã‚„æ™‚é–“å¸¯ã«ã‚ˆã‚Šå¤‰å‹•ã—ã¾ã™
            </div>

            {/* åŸºæœ¬è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« */}
            {showBasicSettings && (
              <div className="fixed inset-0 bg-white z-50 flex flex-col overscroll-contain">
                <div className="bg-white w-full h-full flex flex-col">
                  <div className="bg-white border-b border-gray-200 p-4 flex items-center justify-between flex-shrink-0">
                    <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                      <Settings />
                      è¨­å®š
                    </h2>
                    <button
                      onClick={() => setShowBasicSettings(false)}
                      className="text-gray-500 hover:text-gray-700 text-2xl"
                    >
                      Ã—
                    </button>
                  </div>

                  <div className="p-6 space-y-4 overflow-y-auto flex-1">
                    {/* ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒ */}
                    <div className="bg-gray-50 rounded-xl p-4 border-2 border-gray-200">
                      <label className="flex items-center justify-between cursor-pointer">
                        <div>
                          <div className="text-sm font-medium text-gray-700">ç®—å‡ºæ–¹æ³•</div>
                          <div className="text-xs text-gray-500 mt-1">
                            {useAutoCalculate ? 'å±¥æ­´ã‹ã‚‰è‡ªå‹•ç®—å‡º' : 'æ‰‹å‹•å…¥åŠ›'}
                          </div>
                        </div>
                        <div className="relative">
                          <input
                            type="checkbox"
                            checked={useAutoCalculate}
                            onChange={(e) => setUseAutoCalculate(e.target.checked)}
                            className="sr-only peer"
                          />
                          <div className="w-14 h-7 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-green-500"></div>
                        </div>
                      </label>
                    </div>

                    {/* å±¥æ­´ã‹ã‚‰ç®—å‡ºã—ãŸå€¤ã‚’è¡¨ç¤º */}
                    {useAutoCalculate && (() => {
                      const calcValues = calculateFromHistory();
                      return (
                        <>
                          <div className="bg-blue-50 rounded-xl p-4 border-2 border-blue-200">
                            <div className="text-sm font-medium text-blue-800 mb-3">ğŸ“Š æœˆï½æœ¨ï¼ˆå±¥æ­´ã‹ã‚‰ç®—å‡ºï¼‰</div>
                            <div className="space-y-2">
                              <div className="flex justify-between items-center">
                                <span className="text-sm text-gray-700">å¹³å‡å˜ä¾¡:</span>
                                <span className="text-lg font-bold text-blue-600">Â¥{calcValues.weekdayAvgPrice}/ä»¶</span>
                              </div>
                              <div className="flex justify-between items-center">
                                <span className="text-sm text-gray-700">å¹³å‡é…é”ä»¶æ•°:</span>
                                <span className="text-lg font-bold text-blue-600">{calcValues.weekdayDeliveriesPerHour}ä»¶/æ™‚é–“</span>
                              </div>
                            </div>
                          </div>
                          <div className="bg-purple-50 rounded-xl p-4 border-2 border-purple-200">
                            <div className="text-sm font-medium text-purple-800 mb-3">ğŸ“Š é‡‘ï½æ—¥ï¼ˆå±¥æ­´ã‹ã‚‰ç®—å‡ºï¼‰</div>
                            <div className="space-y-2">
                              <div className="flex justify-between items-center">
                                <span className="text-sm text-gray-700">å¹³å‡å˜ä¾¡:</span>
                                <span className="text-lg font-bold text-purple-600">Â¥{calcValues.weekendAvgPrice}/ä»¶</span>
                              </div>
                              <div className="flex justify-between items-center">
                                <span className="text-sm text-gray-700">å¹³å‡é…é”ä»¶æ•°:</span>
                                <span className="text-lg font-bold text-purple-600">{calcValues.weekendDeliveriesPerHour}ä»¶/æ™‚é–“</span>
                              </div>
                            </div>
                          </div>
                        </>
                      );
                    })()}

                    {/* æ‰‹å‹•å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */}
                    {!useAutoCalculate && (
                      <>
                        <div className="bg-blue-50 rounded-xl p-4 border-2 border-blue-200">
                          <div className="text-sm font-medium text-blue-800 mb-3">ğŸ“ æœˆï½æœ¨</div>
                          <div className="space-y-3">
                            <div>
                              <label className="block text-xs font-medium text-gray-700 mb-1">
                                å¹³å‡å˜ä¾¡(å††/ä»¶)
                              </label>
                              <input
                                type="number"
                                step="10"
                                value={weekdayAvgPrice || ''}
                                onChange={(e) => setWeekdayAvgPrice(parseFloat(e.target.value) || 0)}
                                onKeyDown={handleKeyDown}
                                className="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-base"
                              />
                            </div>
                            <div>
                              <label className="block text-xs font-medium text-gray-700 mb-1">
                                1æ™‚é–“å½“ãŸã‚Šã®å¹³å‡é…é”ä»¶æ•°
                              </label>
                              <input
                                type="number"
                                step="0.1"
                                value={weekdayDeliveriesPerHour || ''}
                                onChange={(e) => setWeekdayDeliveriesPerHour(parseFloat(e.target.value) || 0)}
                                onKeyDown={handleKeyDown}
                                className="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-base"
                              />
                            </div>
                          </div>
                        </div>

                        <div className="bg-purple-50 rounded-xl p-4 border-2 border-purple-200">
                          <div className="text-sm font-medium text-purple-800 mb-3">ğŸ“ é‡‘ï½æ—¥</div>
                          <div className="space-y-3">
                            <div>
                              <label className="block text-xs font-medium text-gray-700 mb-1">
                                å¹³å‡å˜ä¾¡(å††/ä»¶)
                              </label>
                              <input
                                type="number"
                                step="10"
                                value={weekendAvgPrice || ''}
                                onChange={(e) => setWeekendAvgPrice(parseFloat(e.target.value) || 0)}
                                onKeyDown={handleKeyDown}
                                className="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none text-base"
                              />
                            </div>
                            <div>
                              <label className="block text-xs font-medium text-gray-700 mb-1">
                                1æ™‚é–“å½“ãŸã‚Šã®å¹³å‡é…é”ä»¶æ•°
                              </label>
                              <input
                                type="number"
                                step="0.1"
                                value={weekendDeliveriesPerHour || ''}
                                onChange={(e) => setWeekendDeliveriesPerHour(parseFloat(e.target.value) || 0)}
                                onKeyDown={handleKeyDown}
                                className="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none text-base"
                              />
                            </div>
                          </div>
                        </div>
                      </>
                    )}

                    {/* ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©å…ƒ */}
                    <div className="bg-gray-50 rounded-xl p-4 border-2 border-gray-200">
                      <div className="text-sm font-medium text-gray-700 mb-3">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©å…ƒ</div>
                      <div className="space-y-2">
                        <button
                          onClick={exportData}
                          className="w-full bg-blue-500 text-white py-2 px-4 rounded-lg font-medium hover:bg-blue-600 transition-colors text-sm"
                        >
                          ğŸ“¤ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                        </button>
                        <input
                          ref={fileInputRef}
                          type="file"
                          accept=".json"
                          onChange={importData}
                          className="hidden"
                        />
                        <button
                          onClick={() => fileInputRef.current?.click()}
                          className="w-full bg-green-500 text-white py-2 px-4 rounded-lg font-medium hover:bg-green-600 transition-colors text-sm"
                        >
                          ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                        </button>
                        <p className="text-xs text-gray-500 mt-2">
                          â€»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¦ãŠãã¨ã€ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã§ãã¾ã™
                        </p>
                      </div>
                    </div>
                  </div>

                  <div className="p-4 border-t border-gray-200 flex-shrink-0">
                    <button
                      onClick={() => setShowBasicSettings(false)}
                      className="w-full bg-gray-500 text-white py-3 rounded-xl font-medium hover:bg-gray-600 transition-colors"
                    >
                      é–‰ã˜ã‚‹
                    </button>
                  </div>
                </div>
              </div>
            )}
            
            {/* å±¥æ­´ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« */}
            {showCalendar && (
              <div className="fixed inset-0 bg-white z-50 flex flex-col overscroll-contain">
                <div className="bg-white w-full h-full flex flex-col">
                  <div className="bg-white border-b border-gray-200 p-4 flex items-center justify-between flex-shrink-0">
                    <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                      <Calendar />
                      ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
                    </h2>
                    <button
                      onClick={() => setShowCalendar(false)}
                      className="text-gray-500 hover:text-gray-700 text-2xl"
                    >
                      Ã—
                    </button>
                  </div>

                  <div className="p-6 overflow-y-auto flex-1">
                    {/* æœˆåˆ‡ã‚Šæ›¿ãˆ */}
                    <div className="flex items-center justify-between mb-4">
                      <button
                        onClick={() => changeMonth(-1)}
                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                      >
                        â† å‰æœˆ
                      </button>
                      <h3 className="text-lg font-bold">
                        {currentMonth.getFullYear()}å¹´ {currentMonth.getMonth() + 1}æœˆ
                      </h3>
                      <button
                        onClick={() => changeMonth(1)}
                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                      >
                        æ¬¡æœˆ â†’
                      </button>
                    </div>

                    {/* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚°ãƒªãƒƒãƒ‰ */}
                    <div className="mb-4">
                      {/* æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæœˆæ›œå§‹ã¾ã‚Šï¼‰ */}
                      <div className="grid grid-cols-7 gap-1 mb-2">
                        {['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥'].map(day => (
                          <div key={day} className="text-center text-xs font-medium text-gray-600 py-2">
                            {day}
                          </div>
                        ))}
                      </div>

                      {/* æ—¥ä»˜ã‚°ãƒªãƒƒãƒ‰ */}
                      <div className="grid grid-cols-7 gap-1">
                        {generateCalendarDays().map((dayInfo, index) => {
                          // å½“æœˆä»¥å¤–ã¯ç©ºã‚»ãƒ«ã‚’è¡¨ç¤º
                          if (!dayInfo.isCurrentMonth) {
                            return <div key={index} className="aspect-square"></div>;
                          }

                          const dateStr = formatDateToLocal(dayInfo.date);
                          const dayData = dailyData[dateStr];
                          const hasData = dayData && (dayData.hours > 0 || dayData.deliveries > 0 || dayData.earnings > 0 || dayData.quest > 0);
                          const isToday = dateStr === formatDateToLocal(new Date());

                          // åˆè¨ˆå£²ä¸Šã‚’è¨ˆç®—ï¼ˆåŸºæœ¬å£²ä¸Š + ã‚¯ã‚¨ã‚¹ãƒˆå ±é…¬ï¼‰
                          const totalDailyEarnings = hasData
                            ? (dayData.earnings || 0) + (dayData.quest || 0)
                            : 0;

                          return (
                            <button
                              key={index}
                              onClick={() => handleDateClick(dayInfo.date)}
                              className={`
                                aspect-square p-1 rounded-lg text-sm relative flex flex-col items-center justify-center text-gray-800
                                ${isToday ? 'ring-2 ring-blue-500' : ''}
                                ${hasData ? 'bg-purple-100 hover:bg-purple-200' : 'hover:bg-gray-100'}
                                transition-colors
                              `}
                            >
                              <div className="font-medium">{dayInfo.date.getDate()}</div>
                              {hasData && (
                                <div className="text-[9px] text-purple-600 font-bold leading-tight">
                                  Â¥{Math.floor(totalDailyEarnings).toLocaleString()}
                                </div>
                              )}
                            </button>
                          );
                        })}
                      </div>
                    </div>

                    {/* æœˆé–“é›†è¨ˆ */}
                    {(() => {
                      const monthData = Object.entries(dailyData).filter(([dateStr]) => {
                        const date = new Date(dateStr + 'T00:00:00');
                        return date.getFullYear() === currentMonth.getFullYear() &&
                               date.getMonth() === currentMonth.getMonth();
                      });

                      if (monthData.length === 0) return null;

                      const totalHours = monthData.reduce((sum, [, data]) => sum + (data.hours || 0), 0);
                      const totalDeliveries = monthData.reduce((sum, [dateStr, data]) => {
                        // é…é”ä»¶æ•°ãŒå…¥åŠ›ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ç¨¼åƒæ™‚é–“ã‹ã‚‰è‡ªå‹•è¨ˆç®—
                        const effectiveValues = getEffectiveValues();
                        const date = new Date(dateStr + 'T00:00:00');
                        const dayOfWeek = date.getDay();
                        const isWeekday = dayOfWeek >= 1 && dayOfWeek <= 4;
                        const deliveries = isWeekday ? effectiveValues.weekdayDeliveriesPerHour : effectiveValues.weekendDeliveriesPerHour;
                        return sum + (data.deliveries || (data.hours * deliveries));
                      }, 0);
                      const totalEarnings = monthData.reduce((sum, [dateStr, data]) => {
                        // åŸºæœ¬å£²ä¸ŠãŒå…¥åŠ›ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ç¨¼åƒæ™‚é–“ã‹ã‚‰è‡ªå‹•è¨ˆç®—
                        const effectiveValues = getEffectiveValues();
                        const date = new Date(dateStr + 'T00:00:00');
                        const dayOfWeek = date.getDay();
                        const isWeekday = dayOfWeek >= 1 && dayOfWeek <= 4;
                        const price = isWeekday ? effectiveValues.weekdayAvgPrice : effectiveValues.weekendAvgPrice;
                        const deliveries = isWeekday ? effectiveValues.weekdayDeliveriesPerHour : effectiveValues.weekendDeliveriesPerHour;
                        return sum + (data.earnings || (data.hours * deliveries * price));
                      }, 0);
                      const totalQuest = monthData.reduce((sum, [, data]) => sum + (data.quest || 0), 0);

                      // å¹³å‡å€¤ã®è¨ˆç®—
                      const avgPricePerDelivery = totalDeliveries > 0 ? totalEarnings / totalDeliveries : 0;
                      const avgDeliveriesPerHour = totalHours > 0 ? totalDeliveries / totalHours : 0;

                      return (
                        <div className="bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-4 border border-purple-200">
                          <h4 className="font-bold text-gray-800 mb-3">æœˆé–“é›†è¨ˆ</h4>
                          <div className="grid grid-cols-2 gap-3 text-sm">
                            <div className="bg-white/60 rounded-lg p-2">
                              <div className="text-gray-600 text-xs">ç¨¼åƒæ™‚é–“</div>
                              <div className="font-bold">{totalHours.toFixed(1)}æ™‚é–“</div>
                            </div>
                            <div className="bg-white/60 rounded-lg p-2">
                              <div className="text-gray-600 text-xs">é…é”ä»¶æ•°</div>
                              <div className="font-bold">{Math.floor(totalDeliveries)}ä»¶</div>
                            </div>
                            <div className="bg-white/60 rounded-lg p-2">
                              <div className="text-gray-600 text-xs">åŸºæœ¬å£²ä¸Š</div>
                              <div className="font-bold">Â¥{Math.floor(totalEarnings).toLocaleString()}</div>
                            </div>
                            <div className="bg-white/60 rounded-lg p-2">
                              <div className="text-gray-600 text-xs">ã‚¯ã‚¨ã‚¹ãƒˆ</div>
                              <div className="font-bold">Â¥{Math.floor(totalQuest).toLocaleString()}</div>
                            </div>
                            <div className="bg-white/60 rounded-lg p-2">
                              <div className="text-gray-600 text-xs">å¹³å‡å˜ä¾¡</div>
                              <div className="font-bold">Â¥{Math.floor(avgPricePerDelivery)}</div>
                            </div>
                            <div className="bg-white/60 rounded-lg p-2">
                              <div className="text-gray-600 text-xs">å¹³å‡ä»¶æ•°/æ™‚é–“</div>
                              <div className="font-bold">{avgDeliveriesPerHour.toFixed(1)}ä»¶</div>
                            </div>
                          </div>
                          <div className="mt-3 bg-white/80 rounded-lg p-3 border border-purple-300">
                            <div className="text-gray-600 text-sm">åˆè¨ˆå£²ä¸Š</div>
                            <div className="text-2xl font-bold text-purple-600">
                              Â¥{Math.floor(totalEarnings + totalQuest).toLocaleString()}
                            </div>
                          </div>
                        </div>
                      );
                    })()}
                  </div>

                  <div className="p-4 border-t border-gray-200 flex-shrink-0">
                    <button
                      onClick={() => setShowCalendar(false)}
                      className="w-full bg-purple-500 text-white py-3 rounded-xl font-medium hover:bg-purple-600 transition-colors"
                    >
                      é–‰ã˜ã‚‹
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* ã‚¯ã‚¨ã‚¹ãƒˆè¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« */}
            {showQuestSettings && (
              <div className="fixed inset-0 bg-white z-50 flex flex-col overscroll-contain">
                <div className="bg-white w-full h-full flex flex-col">
                  <div className="bg-white border-b border-gray-200 p-4 flex items-center justify-between flex-shrink-0">
                    <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                      <Award />
                      ã‚¯ã‚¨ã‚¹ãƒˆ
                    </h2>
                    <button
                      onClick={() => setShowQuestSettings(false)}
                      className="text-gray-500 hover:text-gray-700 text-2xl"
                    >
                      Ã—
                    </button>
                  </div>

                  <div className="p-6 space-y-6 overflow-y-auto flex-1">
                    {/* æœˆï½æœ¨ã®ã‚¯ã‚¨ã‚¹ãƒˆ */}
                    <div>
                      <h3 className="font-bold text-gray-800 mb-1">æœˆï½æœ¨ã‚¯ã‚¨ã‚¹ãƒˆ</h3>
                      <p className="text-xs text-gray-500 mb-3">â€»å„ã‚¯ã‚¨ã‚¹ãƒˆã¯é †ç•ªã«é”æˆã•ã‚Œã¾ã™</p>
                      <div className="space-y-2">
                        {weekdayQuests.map((quest, index) => (
                          <div key={index} className="flex items-center gap-1.5 p-2 bg-blue-50 rounded-lg">
                            <div className="w-7 h-7 min-w-7 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold text-xs flex-shrink-0">
                              {index + 1}
                            </div>
                            <input
                              type="number"
                              value={quest.count || ''}
                              onChange={(e) => updateWeekdayQuest(index, 'count', e.target.value)}
                              onKeyDown={handleKeyDown}
                              className="w-14 px-2 py-1.5 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-sm text-center flex-shrink-0"
                            />
                            <span className="text-xs text-gray-600 flex-shrink-0">å›</span>
                            <input
                              type="number"
                              step="50"
                              value={quest.reward || ''}
                              onChange={(e) => updateWeekdayQuest(index, 'reward', e.target.value)}
                              onKeyDown={handleKeyDown}
                              className="flex-1 min-w-0 px-2 py-1.5 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-sm text-center"
                            />
                            <span className="text-xs text-gray-600 flex-shrink-0">å††</span>
                          </div>
                        ))}
                      </div>
                    </div>
                    
                    {/* é‡‘ï½æ—¥ã®ã‚¯ã‚¨ã‚¹ãƒˆ */}
                    <div>
                      <h3 className="font-bold text-gray-800 mb-1">é‡‘ï½æ—¥ã‚¯ã‚¨ã‚¹ãƒˆ</h3>
                      <p className="text-xs text-gray-500 mb-3">â€»å„ã‚¯ã‚¨ã‚¹ãƒˆã¯é †ç•ªã«é”æˆã•ã‚Œã¾ã™</p>
                      <div className="space-y-2">
                        {weekendQuests.map((quest, index) => (
                          <div key={index} className="flex items-center gap-1.5 p-2 bg-yellow-50 rounded-lg">
                            <div className="w-7 h-7 min-w-7 bg-yellow-500 text-white rounded-full flex items-center justify-center font-bold text-xs flex-shrink-0">
                              {index + 1}
                            </div>
                            <input
                              type="number"
                              value={quest.count || ''}
                              onChange={(e) => updateWeekendQuest(index, 'count', e.target.value)}
                              onKeyDown={handleKeyDown}
                              className="w-14 px-2 py-1.5 border-2 border-gray-200 rounded-lg focus:border-yellow-500 focus:outline-none text-sm text-center flex-shrink-0"
                            />
                            <span className="text-xs text-gray-600 flex-shrink-0">å›</span>
                            <input
                              type="number"
                              step="50"
                              value={quest.reward || ''}
                              onChange={(e) => updateWeekendQuest(index, 'reward', e.target.value)}
                              onKeyDown={handleKeyDown}
                              className="flex-1 min-w-0 px-2 py-1.5 border-2 border-gray-200 rounded-lg focus:border-yellow-500 focus:outline-none text-sm text-center"
                            />
                            <span className="text-xs text-gray-600 flex-shrink-0">å††</span>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>

                  <div className="p-4 border-t border-gray-200 flex-shrink-0">
                    <button
                      onClick={() => setShowQuestSettings(false)}
                      className="w-full bg-yellow-500 text-white py-3 rounded-xl font-medium hover:bg-yellow-600 transition-colors"
                    >
                      å®Œäº†
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* æ—¥ä»˜ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« */}
            {showDayEdit && selectedDate && (
              <div className="fixed inset-0 bg-white z-[60] flex flex-col overscroll-contain">
                <div className="bg-white w-full h-full flex flex-col">
                  <div className="bg-gradient-to-r from-purple-500 to-blue-500 text-white p-4 flex-shrink-0">
                    <div className="flex items-center justify-between">
                      <button
                        onClick={() => {
                          setShowDayEdit(false);
                          setIsChangingDate(true);
                          setShowCalendar(true);
                        }}
                        className="text-xl font-bold hover:opacity-80 transition-opacity text-left"
                      >
                        {new Date(selectedDate + 'T00:00:00').toLocaleDateString('ja-JP', {
                          year: 'numeric',
                          month: 'long',
                          day: 'numeric',
                          weekday: 'short'
                        })}
                        <span className="text-xs ml-2">ğŸ“…</span>
                      </button>
                      <button
                        onClick={() => setShowDayEdit(false)}
                        className="text-white hover:text-gray-200 text-2xl"
                      >
                        Ã—
                      </button>
                    </div>
                  </div>

                  <div className="p-6 space-y-4 overflow-y-auto flex-1">

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        ç¨¼åƒæ™‚é–“
                      </label>
                      <div className="flex items-center gap-2">
                        <input
                          type="number"
                          step="0.5"
                          value={editingDayData.hours || ''}
                          onChange={(e) => setEditingDayData({...editingDayData, hours: parseFloat(e.target.value) || 0})}
                          onKeyDown={handleKeyDown}
                          className="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                          placeholder="0"
                        />
                        <span className="text-gray-600 font-medium">æ™‚é–“</span>
                      </div>
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        é…é”ä»¶æ•°
                      </label>
                      <div className="flex items-center gap-2">
                        <input
                          type="number"
                          value={editingDayData.deliveries || ''}
                          onChange={(e) => setEditingDayData({...editingDayData, deliveries: parseInt(e.target.value) || 0})}
                          onKeyDown={handleKeyDown}
                          className="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                          placeholder={editingDayData.hours > 0 ? (() => {
                            const effectiveValues = getEffectiveValues();
                            const date = new Date(selectedDate + 'T00:00:00');
                            const dayOfWeek = date.getDay();
                            const isWeekday = dayOfWeek >= 1 && dayOfWeek <= 4;
                            const deliveries = isWeekday ? effectiveValues.weekdayDeliveriesPerHour : effectiveValues.weekendDeliveriesPerHour;
                            return Math.floor(editingDayData.hours * deliveries).toString();
                          })() : "0"}
                        />
                        <span className="text-gray-600 font-medium">ä»¶</span>
                      </div>
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        åŸºæœ¬å£²ä¸Š
                      </label>
                      <div className="flex items-center gap-2">
                        <input
                          type="number"
                          step="100"
                          value={editingDayData.earnings || ''}
                          onChange={(e) => setEditingDayData({...editingDayData, earnings: parseInt(e.target.value) || 0})}
                          onKeyDown={handleKeyDown}
                          className="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                          placeholder={editingDayData.hours > 0 ? (() => {
                            const effectiveValues = getEffectiveValues();
                            const date = new Date(selectedDate + 'T00:00:00');
                            const dayOfWeek = date.getDay();
                            const isWeekday = dayOfWeek >= 1 && dayOfWeek <= 4;
                            const price = isWeekday ? effectiveValues.weekdayAvgPrice : effectiveValues.weekendAvgPrice;
                            const deliveries = isWeekday ? effectiveValues.weekdayDeliveriesPerHour : effectiveValues.weekendDeliveriesPerHour;
                            return Math.floor(editingDayData.hours * deliveries * price).toString();
                          })() : "0"}
                        />
                        <span className="text-gray-600 font-medium">å††</span>
                      </div>
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        ã‚¯ã‚¨ã‚¹ãƒˆå ±é…¬
                      </label>
                      <div className="flex items-center gap-2">
                        <input
                          type="number"
                          step="100"
                          value={editingDayData.quest || ''}
                          onChange={(e) => setEditingDayData({...editingDayData, quest: parseInt(e.target.value) || 0})}
                          onKeyDown={handleKeyDown}
                          className="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                          placeholder="0"
                        />
                        <span className="text-gray-600 font-medium">å††</span>
                      </div>
                    </div>

                    {/* åˆè¨ˆè¡¨ç¤º */}
                    <div className="bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-4 border border-purple-200">
                      <div className="text-sm text-gray-600 mb-1">ã“ã®æ—¥ã®åˆè¨ˆ</div>
                      <div className="text-2xl font-bold text-purple-600">
                        Â¥{(() => {
                          const effectiveValues = getEffectiveValues();
                          const date = new Date(selectedDate + 'T00:00:00');
                          const dayOfWeek = date.getDay();
                          const isWeekday = dayOfWeek >= 1 && dayOfWeek <= 4;
                          const price = isWeekday ? effectiveValues.weekdayAvgPrice : effectiveValues.weekendAvgPrice;
                          const deliveries = isWeekday ? effectiveValues.weekdayDeliveriesPerHour : effectiveValues.weekendDeliveriesPerHour;
                          return (
                            (editingDayData.earnings || (editingDayData.hours * deliveries * price)) +
                            (editingDayData.quest || 0)
                          ).toLocaleString();
                        })()}
                      </div>
                    </div>
                  </div>

                  <div className="p-4 border-t border-gray-200 flex-shrink-0">
                    <div className="flex gap-2">
                      <button
                        onClick={saveDayData}
                        className="flex-1 bg-purple-500 text-white py-3 rounded-xl font-medium hover:bg-purple-600 transition-colors"
                      >
                        ä¿å­˜
                      </button>
                      {dailyData[selectedDate] && (
                        <button
                          onClick={deleteDayData}
                          className="px-6 bg-red-500 text-white py-3 rounded-xl font-medium hover:bg-red-600 transition-colors"
                        >
                          å‰Šé™¤
                        </button>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ - ã‚¨ãƒ©ãƒ¼ã‚’ç”»é¢ã«è¡¨ç¤ºï¼ˆrenderã®å‰ã«è¨­å®šï¼‰
    window.onerror = function(msg, url, lineNo, columnNo, error) {
      console.error('Global error caught:', { msg, url, lineNo, columnNo, error });

      // localStorageã®çŠ¶æ…‹ã‚’ç¢ºèª
      let localStorageInfo = '';
      try {
        const keys = Object.keys(localStorage);
        localStorageInfo = `<p><strong>localStorage keys:</strong> ${keys.join(', ')}</p>`;
      } catch (e) {
        localStorageInfo = `<p><strong>localStorage:</strong> ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“</p>`;
      }

      const errorDiv = document.createElement('div');
      errorDiv.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:white;z-index:99999;padding:20px;overflow:auto;font-family:monospace;font-size:14px;';
      errorDiv.innerHTML = `
        <h1 style="color:red;">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h1>
        <p><strong>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</strong> ${msg}</p>
        <p><strong>URL:</strong> ${url || 'unknown'}</p>
        <p><strong>è¡Œ:</strong> ${lineNo}</p>
        <p><strong>åˆ—:</strong> ${columnNo}</p>
        <p><strong>ã‚¨ãƒ©ãƒ¼:</strong> ${error?.stack || error || 'null'}</p>
        ${localStorageInfo}
        <div style="margin-top:20px;">
          <button onclick="localStorage.clear();location.reload();" style="padding:10px 20px;font-size:16px;margin-right:10px;">
            localStorageã‚’ã‚¯ãƒªã‚¢ã—ã¦å†èª­ã¿è¾¼ã¿
          </button>
          <button onclick="location.reload();" style="padding:10px 20px;font-size:16px;">
            ãã®ã¾ã¾å†èª­ã¿è¾¼ã¿
          </button>
        </div>
      `;
      document.body.appendChild(errorDiv);
      return false;
    };

    // Promise rejection ã®ã‚¨ãƒ©ãƒ¼ã‚‚ã‚­ãƒ£ãƒƒãƒ
    window.addEventListener('unhandledrejection', function(event) {
      const errorDiv = document.createElement('div');
      errorDiv.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:white;z-index:99999;padding:20px;overflow:auto;font-family:monospace;font-size:14px;';
      errorDiv.innerHTML = `
        <h1 style="color:red;">Promise ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h1>
        <p><strong>ç†ç”±:</strong> ${event.reason}</p>
        <button onclick="localStorage.clear();location.reload();" style="padding:10px 20px;font-size:16px;margin-top:20px;">
          localStorageã‚’ã‚¯ãƒªã‚¢ã—ã¦å†èª­ã¿è¾¼ã¿
        </button>
      `;
      document.body.appendChild(errorDiv);
    });

    // Render the app
    try {
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<UberEatsSimulator />);
    } catch (error) {
      const errorDiv = document.createElement('div');
      errorDiv.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:white;z-index:99999;padding:20px;overflow:auto;font-family:monospace;font-size:14px;';
      errorDiv.innerHTML = `
        <h1 style="color:red;">ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚¨ãƒ©ãƒ¼</h1>
        <p><strong>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</strong> ${error.message}</p>
        <p><strong>ã‚¹ã‚¿ãƒƒã‚¯:</strong></p>
        <pre style="background:#f5f5f5;padding:10px;overflow:auto;">${error.stack}</pre>
        <button onclick="localStorage.clear();location.reload();" style="padding:10px 20px;font-size:16px;margin-top:20px;">
          localStorageã‚’ã‚¯ãƒªã‚¢ã—ã¦å†èª­ã¿è¾¼ã¿
        </button>
      `;
      document.body.appendChild(errorDiv);
      throw error;
    }

    // Service Workerã®ç™»éŒ²
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(registration => console.log('SW registered'))
          .catch(err => console.log('SW registration failed'));
      });
    }
  </script>
</body>
</html>